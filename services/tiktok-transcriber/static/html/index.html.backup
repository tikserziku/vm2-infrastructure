<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TikTok Transcriber - Oracle VM</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body { 
            padding-top: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .card {
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .card-header {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border-radius: 15px 15px 0 0 !important;
        }
        .progress-container { margin: 20px 0; }
        #transcription-result, #summary-result {
            height: 400px;
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-y: auto;
            border-radius: 10px;
        }
        .api-error {
            display: none;
            margin-bottom: 15px;
            padding: 10px 15px;
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 10px;
            color: #721c24;
        }
        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
        }
        .btn-primary:hover {
            background: linear-gradient(45deg, #5a67d8, #6b4199);
        }
        .server-status {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            align-items: center;
            background: rgba(255,255,255,0.9);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
        }
        .status-dot {
            width: 8px;
            height: 8px;
            background: #4caf50;
            border-radius: 50%;
            margin-right: 5px;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        .model-badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            margin-left: 5px;
            font-weight: bold;
        }
        .badge-new { background: #4caf50; color: white; }
        .badge-pro { background: #ff9800; color: white; }
        .badge-fast { background: #2196f3; color: white; }
        .badge-audio { background: #9c27b0; color: white; }
        .badge-image { background: #e91e63; color: white; }
        .badge-live { background: #f44336; color: white; }
        
        select option:disabled {
            font-weight: bold;
            color: #999;
            background: #f0f0f0;
        }
    </style>
</head>
<body>
    <div class="server-status">
        <span class="status-dot"></span>
        Oracle VM Active
    </div>
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-10">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h2 class="mb-0">
                            <i class="bi bi-camera-video"></i> TikTok Transcriber
                        </h2>
                        <span class="badge bg-light text-dark">Powered by Gemini 2.5</span>
                    </div>
                    <div class="card-body">
                        <div id="api-error" class="api-error">
                            <strong>–û—à–∏–±–∫–∞:</strong> <span id="error-message"></span>
                        </div>
                        
                        <form id="transcribe-form">
                            <div class="mb-3">
                                <label for="video-url" class="form-label">
                                    <i class="bi bi-link-45deg"></i> URL –≤–∏–¥–µ–æ
                                </label>
                                <input type="text" class="form-control" id="video-url" 
                                    placeholder="https://www.tiktok.com/@username/video/... –∏–ª–∏ YouTube, Instagram, Facebook" required>
                            </div>
                            
                            <div class="mb-3">
                                <label for="api-key" class="form-label">
                                    <i class="bi bi-key"></i> API –∫–ª—é—á Google Gemini
                                </label>
                                <input type="password" class="form-control" id="api-key" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à API –∫–ª—é—á">
                                <div class="form-text">
                                    –ü–æ–ª—É—á–∏—Ç–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫–ª—é—á –Ω–∞ 
                                    <a href="https://ai.google.dev/" target="_blank">Google AI Studio</a>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-8">
                                    <div class="mb-3">
                                        <label for="model-select" class="form-label">
                                            <i class="bi bi-cpu"></i> –ú–æ–¥–µ–ª—å
                                        </label>
                                        <select class="form-select" id="model-select">
                                            <optgroup label="üöÄ Gemini 2.5 Series (–ù–æ–≤–µ–π—à–∏–µ)">
                                                <option value="gemini-2.5-pro">Gemini 2.5 Pro - –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–µ –º—ã—à–ª–µ–Ω–∏–µ</option>
                                                <option value="gemini-2.5-flash" selected>Gemini 2.5 Flash - –ë—ã—Å—Ç—Ä–∞—è –∏ —É–º–Ω–∞—è</option>
                                                <option value="gemini-2.5-flash-lite">Gemini 2.5 Flash-Lite - –°–∞–º–∞—è —ç–∫–æ–Ω–æ–º–∏—á–Ω–∞—è</option>
                                            </optgroup>
                                            
                                            <optgroup label="üéôÔ∏è –° –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∞—É–¥–∏–æ">
                                                <option value="gemini-2.5-flash-preview-native-audio-dialog">Gemini 2.5 Native Audio - –î–∏–∞–ª–æ–≥–∏</option>
                                                <option value="gemini-2.5-flash-exp-native-audio-thinking-dialog">Gemini 2.5 Native Audio - –° —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è–º–∏</option>
                                                <option value="gemini-live-2.5-flash-preview">Gemini 2.5 Live - –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è</option>
                                            </optgroup>
                                            
                                            <optgroup label="üé® –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ">
                                                <option value="gemini-2.5-flash-image-preview">Gemini 2.5 Image - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</option>
                                                <option value="gemini-2.5-flash-preview-tts">Gemini 2.5 TTS Flash - –°–∏–Ω—Ç–µ–∑ —Ä–µ—á–∏</option>
                                                <option value="gemini-2.5-pro-preview-tts">Gemini 2.5 TTS Pro - –ü—Ä–µ–º–∏—É–º —Å–∏–Ω—Ç–µ–∑</option>
                                            </optgroup>
                                            
                                            <optgroup label="‚ö° Gemini 2.0 Series">
                                                <option value="gemini-2.0-flash">Gemini 2.0 Flash - –°—Ç—Ä–∏–º–∏–Ω–≥</option>
                                                <option value="gemini-2.0-flash-lite">Gemini 2.0 Flash-Lite - –ù–∏–∑–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞</option>
                                                <option value="gemini-2.0-flash-live-001">Gemini 2.0 Live - –í–∏–¥–µ–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ</option>
                                                <option value="gemini-2.0-flash-preview-image-generation">Gemini 2.0 Image Gen - –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç–∏–Ω–æ–∫</option>
                                            </optgroup>
                                            
                                            <optgroup label="üîß –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ">
                                                <option value="gemini-1.5-flash">Gemini 1.5 Flash</option>
                                                <option value="gemini-1.5-pro">Gemini 1.5 Pro</option>
                                            </optgroup>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label for="lang-select" class="form-label">
                                            <i class="bi bi-translate"></i> –Ø–∑—ã–∫
                                        </label>
                                        <select class="form-select" id="lang-select">
                                            <option value="ru">üá∑üá∫ –†—É—Å—Å–∫–∏–π</option>
                                            <option value="en">üá¨üáß English</option>
                                            <option value="auto">üåê –ê–≤—Ç–æ</option>
                                            <option value="es">üá™üá∏ Espa√±ol</option>
                                            <option value="fr">üá´üá∑ Fran√ßais</option>
                                            <option value="de">üá©üá™ Deutsch</option>
                                            <option value="zh">üá®üá≥ ‰∏≠Êñá</option>
                                            <option value="ja">üáØüáµ Êó•Êú¨Ë™û</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <button type="submit" class="btn btn-primary w-100">
                                <i class="bi bi-play-circle"></i> –ù–∞—á–∞—Ç—å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—é
                            </button>
                        </form>
                        
                        <div id="progress-container" style="margin: 20px 0; display: none;">
                            <div class="progress">
                                <div id="progress-bar" class="progress-bar progress-bar-striped progress-bar-animated" 
                                    role="progressbar" style="width: 0%"></div>
                            </div>
                            <div id="progress-text" class="text-center mt-2">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞...</div>
                        </div>
                        
                        <div id="result-container" style="margin-top: 20px; display: none;">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <h5><i class="bi bi-text-left"></i> –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è</h5>
                                        <button class="btn btn-sm btn-outline-secondary" onclick="copyText('transcription-result')">
                                            <i class="bi bi-clipboard"></i>
                                        </button>
                                    </div>
                                    <textarea class="form-control" id="transcription-result" readonly></textarea>
                                </div>
                                <div class="col-md-6">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <h5><i class="bi bi-card-text"></i> –ö—Ä–∞—Ç–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ</h5>
                                        <button class="btn btn-sm btn-outline-secondary" onclick="copyText('summary-result')">
                                            <i class="bi bi-clipboard"></i>
                                        </button>
                                    </div>
                                    <textarea class="form-control" id="summary-result" readonly></textarea>
                                </div>
                            </div>
                            
                            <div class="text-center mt-3">
                                <button id="download-audio-btn" class="btn btn-success" style="display: none;">
                                    <i class="bi bi-download"></i> –°–∫–∞—á–∞—Ç—å –∞—É–¥–∏–æ
                                </button>
                            </div>
                        </div>
                        
                        <div class="alert alert-info mt-3" role="alert">
                            <i class="bi bi-info-circle"></i>
                            <strong>–°–æ–≤–µ—Ç:</strong> –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Gemini 2.5 Flash –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–ª–∏ Gemini 2.5 Pro –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Ç–æ—á–Ω–æ—Å—Ç–∏.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const baseURL = window.location.origin;
        let currentAudioId = null;
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π API –∫–ª—é—á
        document.addEventListener('DOMContentLoaded', function() {
            const savedKey = localStorage.getItem('gemini-api-key');
            if (savedKey) {
                document.getElementById('api-key').value = savedKey;
            }
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã
        document.getElementById('transcribe-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const videoUrl = document.getElementById('video-url').value;
            const apiKey = document.getElementById('api-key').value;
            const model = document.getElementById('model-select').value;
            const language = document.getElementById('lang-select').value;
            
            if (!videoUrl || !apiKey) {
                showError('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return;
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º API –∫–ª—é—á
            localStorage.setItem('gemini-api-key', apiKey);
            
            // –°–∫—Ä—ã–≤–∞–µ–º –æ—à–∏–±–∫–∏ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            document.getElementById('api-error').style.display = 'none';
            document.getElementById('result-container').style.display = 'none';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
            const progressContainer = document.getElementById('progress-container');
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');
            const submitBtn = document.querySelector('button[type="submit"]');
            
            submitBtn.disabled = true;
            progressContainer.style.display = 'block';
            progressBar.style.width = '10%';
            progressText.textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É...';
            
            // –ò–º–∏—Ç–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            const progressInterval = setInterval(() => {
                const current = parseInt(progressBar.style.width);
                if (current < 90) {
                    progressBar.style.width = (current + 10) + '%';
                    if (current < 30) {
                        progressText.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ...';
                    } else if (current < 60) {
                        progressText.textContent = '–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∞—É–¥–∏–æ...';
                    } else {
                        progressText.textContent = '–¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è —Å ' + model + '...';
                    }
                }
            }, 2000);
            
            try {
                const response = await fetch(`${baseURL}/process`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        video_url: videoUrl,
                        api_key: apiKey,
                        model: model,
                        language: language
                    })
                });
                
                clearInterval(progressInterval);
                progressBar.style.width = '100%';
                progressText.textContent = '–ì–æ—Ç–æ–≤–æ!';
                
                const data = await response.json();
                
                if (data.status === 'error') {
                    throw new Error(data.message);
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                setTimeout(() => {
                    progressContainer.style.display = 'none';
                    displayResults(data);
                }, 1000);
                
            } catch (error) {
                clearInterval(progressInterval);
                progressContainer.style.display = 'none';
                showError(error.message);
            } finally {
                submitBtn.disabled = false;
            }
        });
        
        function displayResults(data) {
            document.getElementById('result-container').style.display = 'block';
            document.getElementById('transcription-result').value = data.transcript || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
            document.getElementById('summary-result').value = data.summary || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
            
            if (data.audio_id) {
                currentAudioId = data.audio_id;
                const btn = document.getElementById('download-audio-btn');
                btn.style.display = 'inline-block';
                btn.onclick = () => downloadAudio(data.audio_id);
            }
        }
        
        function downloadAudio(audioId) {
            window.open(`${baseURL}/download-audio/${audioId}`, '_blank');
        }
        
        function copyText(elementId) {
            const element = document.getElementById(elementId);
            element.select();
            document.execCommand('copy');
            
            // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
            const btn = event.target.closest('button');
            const originalHTML = btn.innerHTML;
            btn.innerHTML = '<i class="bi bi-check"></i>';
            setTimeout(() => btn.innerHTML = originalHTML, 2000);
        }
        
        function showError(message) {
            document.getElementById('api-error').style.display = 'block';
            document.getElementById('error-message').textContent = message;
        }
    </script>
</body>
</html>

